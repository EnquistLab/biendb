

------ Begin process 'BIEN DB process: 'adb_private_1_load_data'' ------

Start: Fri Dec 11 10:20:26 PST 2020
 
Creating schema 'analytical_db_dev'...done (4.60 sec)
Executing module 'install_dependencies'
- Installing functions:
-- f_empty2null...done (.11 sec)
-- geodistkm...done (.10 sec)
-- is_numeric...done (.10 sec)
-- is_date...done (.10 sec)
-----------------------------------
Executing module 'Copy legacy tables':
- 'view_full_occurrence_individual'...done (572.97 sec)
- 'analytical_stem'...done (1313.69 sec)
-----------------------------------
Executing module 'fix_missing_poldivs_1'
 - Parameters:
 -- $curr_db='vegbien'
 -- $curr_sch='analytical_db_dev'
- Creating temporary indexes on vfoi...done (63.33 sec)
- Populating political divisions...done (32.05 sec)
- Dropping the temporary indexes...done (.21 sec)
-----------------------------------
Executing module 'plot_provenance':
- Populating dataset for specimens and removing non-plot plot codes...done (451.97 sec)
- Indexing plot-related columns...done (241.18 sec)
- Creating table plot_provenance...done (48.02 sec)
- Populating table plot_provenance:
-- SALVIAS...done (.17 sec)
-- TEAM...done (.35 sec)
-- VegBank...done (2.77 sec)
-- Remaining plot datasources...done (.60 sec)
-- Final fixes...done (.36 sec)
- Updating plot provenance in table 'view_full_occurrence_individual_dev'...done (3570.97 sec)
-----------------------------------
Executing module 'plot_metadata'
- Creating table plot_metadata...done (762.48 sec)
- Updating existing metadata...done (125.79 sec)
- Creating source-specific metadata tables...done (.10 sec)
- Importing CVS metadata file...done (.72 sec)
- Importing VegBank metadata file...done (.44 sec)
- Importing BIEN2 metadata file...done (1.22 sec)
- Updating CVS metadata...done (.57 sec)
- Updating VegBank metadata...done (2.82 sec)
- Updating BIEN2 metadata...done (9.26 sec)
- Updating remaining metadata...done (1.78 sec)
- Standardizing constrained vocabulary...done (3.44 sec)
- Dropping temporary tables...done (6.01 sec)
- Building remaining indexes...done (4.03 sec)
- Adding foreign key to table 'view_full_occurrence_individual':
-- Indexing candidate key columns...done (232.69 sec)
-- Populating FK column 'plot_metadata_id'...done (1017.64 sec)
- Adding foreign key to table 'analytical_stem'...done (3514.32 sec)
-----------------------------------
Executing module 'datasource_1_load_legacy'
- Creating table datasource...done (.14 sec)
- Inserting existing information for plots...done (1.28 sec)
- Inserting existing information for specimens...done (161.62 sec)
- Extracting proximate data providers...done (.14 sec)
- Copying table 'ih' from schema 'herbaria' to 'analytical_db_dev'...done (.17 sec)
- Updating table 'ih'...done (.49 sec)
- Flagging herbarium data sources...done (.10 sec)
- Indexing...done (.09 sec)
- Adding FKs:
-- Table plot_metadata...done (15.48 sec)
-- Table view_full_occurrence_individual:
--- Indexing candidate keys...done (175.85 sec)
--- Populating FK 'datasource_id'...done (1583.28 sec)
- Updating 'source_type'...done (.10 sec)
- Final fixes...done (.10 sec)
-----------------------------------
Executing module 'fix_missing_poldivs_2'
 - Parameters:
 -- $curr_db='vegbien'
 -- $curr_sch='analytical_db_dev'
- Creating temporary indexes on vfoi...done (59.79 sec)
- Populating political divisions...done (75.52 sec)
- Dropping the temporary indexes...done (.15 sec)
-----------------------------------
Executing module 'Prepare vfoi for inserts':
- Adding autoincrement primary key...done (383.55 sec)
-----------------------------------
Executing module 'Import traits'
- Creating tables:
-- datasource_raw...done (.12 sec)
-- traits_raw...done (.10 sec)
-- agg_traits...done (.33 sec)
- Importing data:
-- 'new_trait_table_8_29_2017_utf8.csv' --> traits_raw...done (474.15 sec)
-- 'datasource_metadata.csv' --> datasource_raw...done (.08 sec)
- Altering schema of table "traits_raw"...done (488.44 sec)
- Correcting raw data:
-- Setting empty strings to null...done (84.91 sec)
-- Correcting misc errors...done (199.94 sec)
-- Creating not null index on column:
--- elevation_m...done (19.86 sec)
--- visiting_date...done (21.29 sec)
--- observation_date...done (77.88 sec)
-- Parsing and correcting "elevation_m"...done (321.48 sec)
-- Parsing and correcting dates:
--- "visiting_date"...done (894.43 sec)
--- "observation_date"...done (4373.57 sec)
- Inserting raw data to main traits table (agg_traits)...done (548.07 sec)
- Correcting name_submitted...done (114.31 sec)
-- Dropping not null indexes:
--- elevation_m...done (.15 sec)
--- visiting_date...done (.15 sec)
--- observation_date...done (.76 sec)
- Creating staging tables...done (.19 sec)
- Loading staging tables:
-- datasource_staging...done (.09 sec)
-- vfoi_staging...done (417.09 sec)
- Correcting staging tables:
-- view_full_occurrence_individual...no corrections needed
- Loading main tables from staging:
-- datasource...done (.27 sec)
-- plot_metadata...done (.19 sec)
-- view_full_occurrence_individual:
--- Inserting records...done (559.76 sec)
--- Indexing foreign keys...done (790.88 sec)
-----------------------------------
Executing module 'Import 'alaus''
- Creating raw data tables:
-- Generic...done (.30 sec)
-- Source-specific...done (.11 sec)
- Importing raw data to table:
-- 'records-2017-08-31.csv' --> ala_raw...done (67.11 sec)
-- 'datasource_metadata.csv' --> datasource_raw...done (.07 sec)
- Creating staging tables...done (10.22 sec)
- Loading staging tables:
-- datasource_staging...done (.09 sec)
-- vfoi_staging...done (32.31 sec)
- Correcting staging tables:
-- view_full_occurrence_individual...under construction!
- Loading main tables from staging:
-- datasource...done (.31 sec)
-- plot_metadata...done (.19 sec)
-- view_full_occurrence_individual:
--- Inserting records...done (22.16 sec)
--- Indexing foreign keys...done (158.96 sec)
-----------------------------------
Executing module 'Import chilesp'
- Creating raw data tables:
-- Generic...done (.25 sec)
-- Source-specific...done (.09 sec)
- Importing raw data to table:
-- 'Chileandatabase.csv' --> chilesp_raw...done (.19 sec)
-- 'datasource_metadata.csv' --> datasource_raw...done (.07 sec)
- Correcting raw data:
-- Creating integer Y, M, D columns...done (.19 sec)
-- Setting empty strings to null...done (.18 sec)
-- Correcting dates...done (1.14 sec)
- Creating staging tables...done (.41 sec)
- Loading staging tables:
-- datasource_staging...done (.08 sec)
-- vfoi_staging...done (.35 sec)
- Correcting staging tables:
-- view_full_occurrence_individual...no corrections needed
- Loading main tables from staging:
-- datasource...done (.25 sec)
-- plot_metadata...done (.19 sec)
-- view_full_occurrence_individual:
--- Inserting records...done (.97 sec)
--- Indexing foreign keys...done (158.30 sec)
-----------------------------------
Executing module 'Import dryflor'
- Creating raw data tables:
-- Generic...done (.25 sec)
-- Source-specific...done (.09 sec)
- Importing raw data to table:
-- 'Dryflor-download-Apr2017_utf8.csv' --> dryflor_raw...done (1.63 sec)
-- 'datasource_metadata.csv' --> datasource_raw...done (.10 sec)
- Correcting raw data:
-- Setting empty strings to null...done (1.62 sec)
- Creating staging tables...done (.31 sec)
- Loading staging tables:
-- datasource_staging...done (.08 sec)
-- vfoi_staging...done (2.85 sec)
- Correcting staging tables:
-- view_full_occurrence_individual...no corrections needed
- Loading main tables from staging:
-- datasource...done (.27 sec)
-- plot_metadata...done (.19 sec)
-- view_full_occurrence_individual:
--- Inserting records...done (5.66 sec)
--- Indexing foreign keys...done (174.62 sec)
-----------------------------------
Executing module 'Import gillespie'
- Creating raw data tables:
-- Generic...done (.25 sec)
-- Source-specific...done (.12 sec)
- Importing raw data to table:
-- 'gillespie_people_unix.csv' --> gillespie_people_raw...done (.10 sec)
-- 'gillespie_plot_descriptions_unix.csv' --> gillespie_plot_descriptions_raw...done (.07 sec)
-- 'gillespie_plot_data_unix.csv' --> gillespie_plot_data_raw...done (.11 sec)
-- 'datasource_metadata.csv' --> datasource_raw...done (.09 sec)
- Correcting raw data:
-- Adding index, primary keys and foreign keys...done (.23 sec)
-- Setting empty strings to null:
--- gillespie_people_raw...done (.09 sec)
--- gillespie_plot_descriptions_raw...done (.09 sec)
--- gillespie_plot_data_raw...done (.15 sec)
- Creating staging tables...done (.37 sec)
- Loading staging tables:
-- datasource_staging...done (.09 sec)
-- plot_metadata_staging...done (.09 sec)
-- vfoi_staging...done (.27 sec)
-- analytical_stem_staging...done (1.93 sec)
- Correcting staging tables:
-- view_full_occurrence_individual...no corrections needed
-- analytical_stem_staging...deleting null dbh records...done (.19 sec)
- Loading main tables from staging:
-- datasource...done (.23 sec)
-- plot_metadata...done (.21 sec)
-- view_full_occurrence_individual:
--- Inserting records...done (1.59 sec)
--- Indexing foreign keys...done (163.56 sec)
-- analytical_stem...done (.24 sec)
-----------------------------------
Executing module 'Import ntt'
- Creating raw data tables:
-- Generic...done (.16 sec)
-- Source-specific...done (.11 sec)
- Extracting MS Access tables to CSVs (NeotropTree.accdb):
-- Species --> 'species.csv'...done (.56 sec)
-- Areas --> 'areas.csv'...done (.32 sec)
-- TheSources --> 'sources.csv'...done (.05 sec)
-- Species-Area --> 'species_areas.csv'...done (.77 sec)
-- TheSources-Areas --> 'sources_areas.csv'...done (.02 sec)
- Importing raw data to table:
-- 'species.csv' --> ntt_species_raw...done (.35 sec)
-- 'areas.csv' --> ntt_areas_raw...done (.20 sec)
-- 'sources.csv' --> ntt_sources_raw...done (.09 sec)
-- 'species_areas.csv' --> ntt_species_areas_raw...done (.92 sec)
-- 'sources_areas.csv' --> ntt_sources_areas_raw...done (.09 sec)
-- 'datasource_metadata.csv' --> datasource_raw...done (.08 sec)
- Correcting raw data:
-- Creating indexes and foreign key constraints...done (2.76 sec)
-- Setting empty strings to null:
--- ntt_species_raw...done (.36 sec)
--- ntt_areas_raw...done (.13 sec)
--- ntt_sources_raw...done (.08 sec)
- Creating staging tables...done (.30 sec)
- Loading staging tables:
-- datasource_staging...done (.09 sec)
-- vfoi_staging...done (22.99 sec)
- Correcting staging tables:
-- view_full_occurrence_individual...no corrections needed
- Loading main tables from staging:
-- datasource...done (.25 sec)
-- plot_metadata...done (.19 sec)
-- view_full_occurrence_individual:
--- Inserting records...done (51.59 sec)
--- Indexing foreign keys...done (203.52 sec)
-----------------------------------
Executing module 'Import rainbio'
- Creating raw data tables:
-- Generic...done (.26 sec)
-- Source-specific...done (.11 sec)
- Importing raw data to table:
-- 'extract_to_be_sent_SPARC.csv' --> rainbio_raw...done (17.20 sec)
-- 'datasource_metadata.csv' --> datasource_raw...done (.09 sec)
- Correcting raw data:
-- Setting empty strings to null...done (15.67 sec)
-- Creating integer Y, M, D columns...done (15.36 sec)
-- Correcting collection dates...done (90.02 sec)
-- Correcting identification dates...done (107.51 sec)
- Creating staging tables...done (1.70 sec)
- Loading staging tables:
-- datasource_staging...done (.09 sec)
-- vfoi_staging...done (14.62 sec)
- Correcting staging tables:
-- view_full_occurrence_individual...no corrections needed
- Loading main tables from staging:
-- datasource...done (.25 sec)
-- plot_metadata...done (.20 sec)
-- view_full_occurrence_individual:
--- Inserting records...done (16.66 sec)
--- Indexing foreign keys...done (184.23 sec)
-----------------------------------
Executing module 'Import schep'
- Creating raw data tables:
-- Generic...done (.23 sec)
-- Source-specific...done (.09 sec)
- Importing raw data to table:
-- 'Schp_PLOTDB_CompleteAndClean_utf8.csv' --> schep_plotdb_raw...done (.11 sec)
-- 'Schp_TREEDB_CompleteAndClean_utf8.csv' --> schep_tree_db_raw...done (.11 sec)
-- 'datasource_metadata.csv' --> datasource_raw...done (.08 sec)
- Correcting raw data:
-- Adding columns to harmonize table schemas...done (.09 sec)
-- Setting empty strings to null:
--- schep_plotdb_raw...done (.11 sec)
--- schep_tree_db_raw...done (.12 sec)
- Creating staging tables...done (.44 sec)
- Loading staging tables:
-- datasource_staging...done (.08 sec)
-- vfoi_staging from table:
--- schep_plotdb_raw...done (.64 sec)
--- schep_tree_db_raw...done (.54 sec)
- Correcting staging tables:
-- view_full_occurrence_individual...no corrections needed
- Loading main tables from staging:
-- datasource...done (.25 sec)
-- plot_metadata...done (.16 sec)
-- view_full_occurrence_individual:
--- Inserting records...done (2.32 sec)
--- Indexing foreign keys...done (166.96 sec)
-----------------------------------
Executing module 'Import GBIF'
- Creating raw data tables:
-- Generic...done (.27 sec)
-- Source-specific...done (.10 sec)
- Importing raw data to table:
-- 'occurrence_cleaned.txt' --> gbif_occurrence_raw:
--- Importing data...done (9463.97 sec)
--- Removing header...done (4010.61 sec)
- Altering raw data table structure...done (.14 sec)
- Processing dates:
-- Populating integer Y, M, D columns...done (31071.55 sec)
-- Correcting dates from column "eventDate"...done (185420.26 sec)
-- Correcting dates from column "dateIdentified"...done (243903.40 sec)
- Indexing raw data...done (436328.50 sec)
- Creating staging tables...done (2.14 sec)
- Loading staging tables:
-- vfoi_staging...done (30161.93 sec)
-- datasource_staging...done (437.88 sec)
- Populating FK to datasource_staging...done (153201.80 sec)
- Dropping raw data indexes...done (95.84 sec)
- Loading main tables from staging:
-- datasource...done (1.26 sec)
-- plot_metadata...done (.29 sec)
-- view_full_occurrence_individual:
--- Inserting records...done (10321.15 sec)
--- Indexing foreign keys...done (10863.94 sec)
Dropping staging table fkey from table vfoi...done (4.87 sec)
-----------------------------------
Checking row counts in table:
- view_full_occurrence_individual_dev...285690756
- agg_traits...26888342
-----------------------------------
Executing module 'datasource_2_export'
- Exporting CSV dump of table datasource for manual editing...done (445.05 sec)
-----------------------------------
Executing module 'endangered_taxa_1_prepare'
- Building endangered species tables:
- Creating tables...done (.96 sec)
- Importing data for 'cites', 'iucn', 'usda'...done (1.99 sec)
- Combining endangered taxon data into single table...done (.45 sec)
-----------------------------------
Executing module 'tnrs'
- Creating TNRS tables...done (.33 sec)
- Extracting verbatim names:
-- view_full_occurrence_individual...done (686.77 sec)
-- agg_traits...done (41.61 sec)
-- endangered_taxa...done (.19 sec)
- Pre-processing names...done (156.98 sec)
- Extracting unique names and adding ID column...done (45.71 sec)
- Exporting names file '/home/bien/tnrs/data/user/tnrs_submitted.csv'...done (1.56 sec)
- Deleting offending names from CSV...done (25.67 sec)
-----------------------------------
Executing module 'gnrs_1_prepare'
- Dropping existing indexes on table:
-- view_full_occurrence_individual...done (8.77 sec)
-- agg_traits...done (.11 sec)
- Populating FK poldivs_full in table:
-- vfoi...done (15805.01 sec)
-- agg_traits...done (2113.10 sec)
-- ih...done (1.03 sec)
- Extracting all political divisions to table poldivs...done (2781.56 sec)
- Exporting CSV file of political divisions for scrubbing by GNRS...done (.98 sec)
-- File: gnrs_submitted.csv
-- Destination directory: /home/bien/gnrs/data/user
-----------------------------------
Executing module 'cds_1_prepare'
- Dropping existing indexes on table:
-- view_full_occurrence_individual...done (.31 sec)
-- agg_traits...done (.11 sec)
- Extracting all verbatim geocoordinate to table cds_submitted...done (2952.28 sec)
- Exporting CSV file of political divisions for scrubbing by CDS...done (12.69 sec)
-- File: cds_submitted.csv
-- Destination directory: /home/bien/cds2/data

Script completed. Next steps:

1. Submit TNRS input for scrubbing
2. Submit GNRS input for scrubbing
3. Submit CDS input for scrubbing
4. After steps 1-3 complete, continue with adb_private_2_import_validations_1.sh

------ Process 'BIEN DB process: 'adb_private_1_load_data'' completed in 910406.70 seconds ------

